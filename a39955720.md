---
timezone: UTC+8
---

> 请在上边的 timezone 添加你的当地时区(UTC)，这会有助于你的打卡状态的自动化更新，如果没有添加，默认为北京时间 UTC+8 时区


# Denny

1. 自我介绍 大家好，我目前專注於 Solidity 智能合約的開發與審計，希望可以透過這次活動學習到更多相關知識。目前也正在尋找相關職缺，如果有相關機會，歡迎推薦給我！
2. 你认为你会完成本次残酷学习吗？ 一定可以
3. 你的联系方式（推荐 Telegram）Telegram:@a39955720

## Notes

<!-- Content_START -->

### 2025.05.14

## EIP-7702 是什麼？

EIP-7702 是一個新的提案，目的是讓傳統的 EOA 可以持久升級成像合約帳戶一樣，具備更多功能，比如一次完成多步操作、讓別人幫你付 gas，或是限制某個 key 只能做特定操作。

這是透過一種新的交易格式來做到的（type 0x04），交易裡會附帶一個「授權清單」，告訴鏈上：「這些帳戶現在起 delegate 給特定合約的 code，直到我再指定新的 code 或清空為止。」

---

## 跟 EIP-4337 和 EIP-6551 有什麼不同？

| 功能   | EIP-7702         | EIP-4337            | EIP-6551      |
| ---- | ---------------- | ------------------- | ------------- |
| 對象   | 普通錢包 (EOA)       | 完整合約錢包系統            | NFT 擴展錢包      |
| 特色   | 輕量、即插即用、不需額外基礎設施 | 架構完整，可完全替代 EOA      | 讓 NFT 擁有自己的錢包 |
| 複雜度  | 低                | 高，需要 EntryPoint 等配合 | 中             |
| 適合場景 | 想快速提升 EOA 體驗     | 長期帳戶抽象路線            | Web3 遊戲、身份系統等 |

---

## 核心功能介紹

### 1. Batching（多步操作一次完成）

像是先 approve、再 transfer，不用兩筆交易，EIP-7702 讓這變成一筆就能搞定。

### 2. Sponsorship（讓別人幫你出 gas）

你簽好交易內容後，可以請第三方幫你發送並支付 gas，他們甚至能用穩定幣或其他 token 向你收費。

### 3. Sub-permissions（權限分級）

你可以發出一把「權限受限」的子鑰匙，例如只能花 ERC20 但不能動 ETH，或設定一天最多只能花 1% 資產。

---

## 它怎麼運作？

* 當你發送 type 0x04 的交易時，你可以在裡面加一個授權清單。
* 每個授權項目會將指定帳戶的 code 設成特殊的「委派指標」，告訴 EVM：「這個帳戶的邏輯現在委派給另一個合約。」
* 執行像 CALL、DELEGATECALL 等指令時，會自動到被委派的合約中抓 code 來執行。

---

## 特別設計小細節

* **Code 不用自己寫**：只要給一個已部署合約的 address 就行，省空間、省 gas。
* **一次授權、多次使用**：7702 的授權設置是持久性的，不像 4337 要每次都包進 EntryPoint，7702 設完之後可以一直用。
* **可以自己贊助自己**：EOA 自己就能發這種交易，不需要別人幫你 relayer。

---

## Gas 成本

* 基礎成本與 EIP-2930 相似，再加上每個授權 tuple 先一次性收取最高可能成本 25000 gas。
* 如果授權帳戶原本非空，則會在執行中退回部分 gas，實際成本為 12500 gas；空帳戶則無退還，成本為完整 25000 gas。

---

## 安全提醒

* 被授權的 delegate contract 要小心撰寫，應具備 nonce、限額、目標合約白名單等 replay protection 機制，避免簽名被重放攻擊。
* 開發者應避免用 `require(tx.origin == msg.sender)` 這種方式做安全檢查，因為這提案可能會破壞這個邏輯。
* 若要變更授權合約，必須注意 storage collision 風險，建議使用 ERC-7201 標準管理 storage，或清空 storage 後再進行授權更換。

---

### 2025.05.15

昨天把 EIP-7702 的官方文檔讀過一遍，雖然大致理解設計理念，但還是有一些地方不是很清楚，所以決定自己整理一份自問自答。

---

**Q:** 為什麼要在授權清單裡加上 chain\_id？

**A:**
主要是為了**防止跨鏈重放攻擊**。chain\_id 就像是「這份授權只給這一條鏈用」，確保你在主網簽的授權，別人不能拿去測試網或其他鏈重放。要全鏈通用的話，chain\_id 可以設成 0。

---

**Q:** EIP-7702 的 y\_parity 到底是什麼？以前不是都用 v 嗎？

**A:**
`y_parity` 就是以前簽名裡那個 `v` 的「奇偶位」，本質上就是 `v` 去掉鏈 ID 之後剩下的那 1 bit。
0 代表偶數、1 代表奇數。新標準直接用 0 或 1，少了 27/28 或鏈 ID 這些混淆，比較直覺好用！

---

**Q:** 我想把一個普通錢包變成 7702 代理模式，流程大致怎麼走？

**A:**

1. 先準備好你要委派的合約 address。
2. 構造一個 type 0x04 的交易，填好授權清單。
3. 交易發上鏈，鏈上會把你的 EOA code 設定成「委派指標」，所有對你這個 EOA 的 CALL 都會去執行指定合約的邏輯。
4. 要恢復成純 EOA，只要再發一次授權為 0x0 的交易即可。

---

**Q:** 如果我委派到一個也在委派別人的合約，EVM 會怎麼辦？會不會死循環？

**A:**
EIP-7702 明確規定**只會追蹤第一層委派**，不會繼續往下找，這樣就不會出現委派 loop 或無限遞迴的 bug。
所以如果你指到另一個有 delegation indicator 的帳戶，EVM 只會拿第一個委派的 address 來執行，不會跳第二、三層。

---

### 2025.05.16

今天我做了一個利用 EIP-7702 來進行一筆同時 approve 和 transfer 的簡單 demo

GitHub Repository: [eip7702-demo](https://github.com/a39955720/eip7702-demo)

---

### 2025.05.16

## EIP-7702 可能的應用場景

### 1. 一次性多步驟操作（Batch Transactions）

* **說明**：傳統 EOA 用戶如果想在去中心化交易所（DEX）進行操作，往往需要先單獨批准（approve）代幣，再另外發送兌換（swap）等多筆交易，既耗時又費 gas。EIP-7702 允許用戶臨時將帳戶變成智慧合約，在一筆交易內自動完成「批准 + 兌換」、「跨多協議的資產搬移」等多步驟操作。
* **範例**：用戶只需一次簽名，就能將手上的 USDC 兌換成 ETH，並直接轉帳給另一個帳戶，省去重複簽名和多筆礦工費。
* **潛在影響**：大幅提升 DeFi 使用體驗，減少出錯風險，讓複雜操作更容易被主流用戶接受。

---

### 2. Gas 贊助（Gas Abstraction）

* **說明**：新用戶往往卡在「沒有 ETH 無法發送第一筆交易」這道門檻。EIP-7702 可讓 Dapp 或第三方臨時插入「由他人代付 Gas」的合約邏輯，用戶在不持有 ETH 的情況下也能順利上鏈互動。
* **範例**：遊戲、NFT 首次鑄造、空投活動等場合，用戶在網站操作時，Dapp 自動替用戶支付 Gas 費，讓 onboarding 流程更加順暢。
* **潛在影響**：降低 Web3 入口門檻，有助於用戶大規模成長。

---

### 3. 社交恢復（Social Recovery）

* **說明**：私鑰遺失是鏈上資產最大的風險。EIP-7702 支持臨時加載社交恢復邏輯（如多數好友簽名、家族成員共識），僅在恢復時需要，多數時間仍為一般帳戶。
* **範例**：用戶遺失私鑰時，只要指定的三位好友同時同意，就能臨時加載恢復邏輯，協助重設帳戶存取權。
* **潛在影響**：讓以太坊帳戶兼具自主管理與可靠的救援機制，降低資產永久丟失機率。

---

### 4. 交易權限控制（Transaction Policy）

* **說明**：EIP-7702 支持臨時加入各種資產管控邏輯，例如白名單、黑名單、多重簽章、多重驗證等，靈活限制帳戶資金流動或提現行為。
* **範例**：公司帳戶可設定大額轉帳需多位管理員同意，或者臨時限制對某些地址的付款，防止內部濫用或外部詐騙。
* **潛在影響**：提升機構、家庭、DAO 等多種場景的安全與資產管控彈性。

---

### 5. 隱私交易與混幣（Privacy/Mixing）

* **說明**：EIP-7702 可臨時加載隱私協議邏輯，執行如 zk-SNARK、混幣、跳板合約等操作，強化資金隱私。
* **範例**：臨時將資金經由混幣協議轉到新地址，或一次性使用零知識證明隱藏交易路徑。
* **潛在影響**：滿足高端用戶與機構對隱私的需求，同時避免永久性複雜設定。

---

### 6. 自定義簽章驗證（Custom Signature Validation）

* **說明**：EIP-7702 可讓帳戶臨時切換到多因素認證（2FA）、生物識別驗證、硬體錢包驗證等進階簽章邏輯，針對大額或高風險操作加強安全。
* **範例**：用戶進行高額轉帳時，錢包自動要求手機 App 二次驗證或生物辨識，普通日常操作則無需額外手續。
* **潛在影響**：大幅提升大戶、機構或重視安全用戶的資產保障層級。

---


<!-- Content_END -->
